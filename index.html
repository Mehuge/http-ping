<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">
.result { font-family: monospace; display: inline-block; margin-left: 0.3em; margin-bottom: 0.3em; padding: 0.1em; min-width: 5em; }
.ok { background-color: limegreen; }
.slow { background-color: #080; }
.slower { background-color: orange; }
.poor { background-color: red; }
.bad { background-color: darkred; }
</style>
</head>
<body id="results">
</body>

<script>
var pings = 0;
var tbody = document.getElementById("result");
var prev = null;
function ping() {
	var start = Date.now();

	var div = document.createElement("div");
	div.className = 'result';
	div.innerText = `${pings} ...`;
	document.body.appendChild(div);

	var xhr = new XMLHttpRequest();
	xhr.open("GET", `ping.xml?${start}`);
	xhr.addEventListener("readystatechange", (response) => {
		if (xhr.readyState == 2) {
			var ms = Date.now() - start;
			div.innerText = `${pings} ${ms} ms`;
			if (ms < 50) div.className += ' ok';
			else if (ms < 100) div.className += ' slow';
			else if (ms < 200) div.className += ' slower';
			else if (ms < 500) div.className += ' poor';
			else div.className += ' bad';
			pings++;
		}
	});
	xhr.send();
}
setInterval(ping, 5000);
</script>
</html>
